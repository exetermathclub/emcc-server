window.JSON||(window.JSON={stringify:function(d){if(d instanceof Object){var f="";if(d.constructor===Array){for(var h=0;h<d.length;f+=this.stringify(d[h])+",",h++);return"["+f.substr(0,f.length-1)+"]"}if(d.toString!==Object.prototype.toString)return'"'+d.toString().replace(/"/g,"\\$&")+'"';for(h in d)f+='"'+h.replace(/"/g,"\\$&")+'":'+this.stringify(d[h])+",";return"{"+f.substr(0,f.length-1)+"}"}return"string"===typeof d?'"'+d.replace(/"/g,"\\$&")+'"':String(d)}});
$(function(){function d(a){var b=e[a];a===c?"none"!==g.css("display")?g.hide():g.show():(c=a,v.show(),l.show(),g.detach(),m.val(b.name),u.each(function(a){this.value=b.members[a]}),w.text(b.paid?"Paid":"Unpaid"),n.val(b.participation?"On-Site":"Online"),p=b.individual,q.prop("checked",p),p?(r.hide(),s.show()):(r.show(),s.hide()),k[a].after(g),g.show())}function f(a){var b=d;a:{var c;for(c=0;c<k.length;c+=1)if(a.target===k[c][0]){a=c;break a}a=void 0}b(a)}function h(a){var b=m.val(),d=[],e="";u.each(function(){d.push(this.value)});
e=("On-Site"===n.val()).toString();return"edit"===a?{purpose:a,id:t[c],name:b,members:JSON.stringify(d),participation:e,individual:q.prop("checked")?"true":"false"}:{purpose:a,name:b,members:JSON.stringify(d),participation:e,individual:q.prop("checked")?"true":"false"}}function y(){var a;ga("send","event","button","team");$.ajax({url:"../wsgi-scripts/teams.py",method:"POST",data:h("register"),success:function(b){a=b.id}});return a}var e,k=[],t=[],p=!1,c=-1,x=$("#team_list"),g=$("#team_edit_pane"),
u=$(".team_member"),w=$("#paid"),n=$("#participation"),m=$("#team_name"),l=$("#new"),v=$("#delete"),q=$("#individual_checkbox"),r=$(".hide_when_indiv"),s=$(".show_when_indiv");$.ajax({url:"../wsgi-scripts/teams.py",method:"GET",data:{purpose:"list"},success:function(a){var b;e=a.teams;for(a=0;a<e.length;a+=1)t[a]=e[a].id,b=$("<div>").addClass("team").text(e[a].name).click(f),k.push(b),x.append(b)}});$("#save").click(function(){var a=[],b,d=t.length;u.each(function(){a.push(this.value)});-1===c?(b=
y(),t[d]=b,e[d]={id:b,name:m.val(),members:a,participation:"On-Site"===n.val(),paid:!1},b=$("<div>").addClass("team").text(e[d].name).click(f),k.push(b),x.append(b),l.show()):($.ajax({url:"../wsgi-scripts/teams.py",method:"POST",data:h("edit")}),e[c].name=m.val(),e[c].members=a,e[c].participation="On-Site"===n.val(),e[c].individual=q.prop("checked"),k[c].text(m.val()));g.hide()});v.click(function(){confirm("Are you sure you want to delete this team?")&&($.ajax({url:"../wsgi-scripts/teams.py",method:"POST",
data:{purpose:"delete",id:t[c]}}),delete e[c],k[c].remove(),k.splice(c,c),g.hide())});$("#cancel").click(function(){l.show();g.hide()});q.click(function(){(p=$(this).prop("checked"))?(r.hide(),s.show()):(r.show(),s.hide())});l.click(function(){c=-1;p=!1;r.show();s.hide();v.hide();m.val("");u.each(function(){this.value=""});w.text("Unpaid");n.val("On-Site");l.after(g);l.hide();g.show()});$.ajax({url:"../wsgi-scripts/checkemail.py",method:"GET",dataType:"json",success:function(a){a.success||1!=a.error?
0===a.error&&(window.location.href="login.shtml"):($(".dialog").show(),$(".cover").show(),$("#dialog_submit").click(function(){-1<$("#dialog_input").val().indexOf("@")?$.ajax({url:"../wsgi-scripts/modify.py",method:"POST",data:{info:JSON.stringify({2:$("#dialog_input").val()})},success:function(){$(".dialog").hide();$(".cover").hide()}}):$("#dialog_tip").text("Please enter a valid email.")}))}})});
