window.JSON||(window.JSON={stringify:function(a){if(a instanceof Object){var b="";if(a.constructor===Array){for(var d=0;d<a.length;b+=this.stringify(a[d])+",",d++);return"["+b.substr(0,b.length-1)+"]"}if(a.toString!==Object.prototype.toString)return'"'+a.toString().replace(/"/g,"\\$&")+'"';for(d in a)b+='"'+d.replace(/"/g,"\\$&")+'":'+this.stringify(a[d])+",";return"{"+b.substr(0,b.length-1)+"}"}return"string"===typeof a?'"'+a.replace(/"/g,"\\$&")+'"':String(a)}});
$(function(){function a(a,b){if("admin"===a){e.addClass("loading");var c=generateA();$.ajax({url:"../wsgi-scripts/admin_auth.py",method:"POST",data:{A:bigInt2str(c.A,16)},dataType:"json",success:function(a){var d=generateKey({uname:"admin",password:b,a:c.a,A:c.A},{B:a.B,salt:a.s});$.ajax({url:"../wsgi-scripts/admin_validate.py",method:"GET",data:{message:JSON.stringify(encrypt(d.K,"SRP_CLIENT_SUCCESS_MESSAGE")),id:a.id},success:function(b){null!==b.message&&"SRP_SERVER_SUCCESS_MESSAGE"===decrypt(d.K,
JSON.parse(b.message))&&(localStorage.SRP_SESS_KEY=d.K.toString(CryptoJS.enc.Base64),localStorage.SRP_ID=a.id,location.href="admin.shtml")}})}});e.removeClass("loading")}else $.ajax({url:"../wsgi-scripts/authenticate.py",method:"POST",data:{username:a,password:CryptoJS.SHA512(b).toString(CryptoJS.enc.Hex)},dataType:"json",success:function(a){if(a.correct){a=location.search.substring(1).split("&");for(var b=0;b<a.length;b+=1){var c=a[b].split("=");if("continue"==decodeURIComponent(c[0])){location.href=
decodeURIComponent(c[1]);return}}window.location.href="dashboard.shtml"}else d.text("Incorrect username or password."),g.focus()}})}function b(a){$.ajax({url:"../wsgi-scripts/resetemail.py",method:"GET",data:{username:a},success:function(){$("#prompt").text("We have sent the password reset information to the email you registered with, please check your email.");e.removeClass("loading");f.removeAttr("disabled");f.text("Resend")},error:function(){e.removeClass("loading");c.css("background-color","yellow")}})}
var d=$("#login_tip"),g=$("#username"),h=$("#password"),m=$("#button"),k=$("#dialog"),l=$("#cover"),c=$("#dialog_input"),f=$("#dialog_submit"),e=$("body");m.click(function(){a(g.val(),h.val())});h.keyup(function(b){b&&13===b.keyCode&&a(g.val(),h.val())});$("#forgot").click(function(){k.show();l.show();c.focus()});l.click(function(){$(this).hide();k.hide()});f.click(function(){""!==c.val()?($(this).attr("disabled",""),e.addClass("loading"),b(c.val())):c.css("background-color","yellow")});c.keydown(function(){f.removeAttr("disabled");
c.css("background-color","")});c.keyup(function(a){a&&13===a.keyCode&&f.click()})});
