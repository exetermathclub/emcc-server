window.JSON||(window.JSON={stringify:function(a){if(a instanceof Object){var b="";if(a.constructor===Array){for(var c=0;c<a.length;b+=this.stringify(a[c])+",",c++);return"["+b.substr(0,b.length-1)+"]"}if(a.toString!==Object.prototype.toString)return'"'+a.toString().replace(/"/g,"\\$&")+'"';for(c in a)b+='"'+c.replace(/"/g,"\\$&")+'":'+this.stringify(a[c])+",";return"{"+b.substr(0,b.length-1)+"}"}return"string"===typeof a?'"'+a.replace(/"/g,"\\$&")+'"':String(a)}});
$(function(){function a(a,b){if("admin"===a){e.addClass("loading");var d=generateA();$.ajax({url:"../wsgi-scripts/admin_auth.py",method:"POST",data:{A:bigInt2str(d.A,16)},dataType:"json",success:function(a){var c=generateKey({uname:"admin",password:b,a:d.a,A:d.A},{B:a.B,salt:a.s});$.ajax({url:"../wsgi-scripts/admin_validate.py",method:"GET",data:{message:JSON.stringify(encrypt(c.K,"SRP_CLIENT_SUCCESS_MESSAGE")),id:a.id},success:function(b){null!==b.message&&"SRP_SERVER_SUCCESS_MESSAGE"===decrypt(c.K,
JSON.parse(b.message))&&(localStorage.SRP_SESS_KEY=c.K.toString(CryptoJS.enc.Base64),localStorage.SRP_ID=a.id,location.href="admin.shtml")}})}});e.removeClass("loading")}else $.ajax({url:"../wsgi-scripts/authenticate.py",method:"POST",data:{username:a,password:CryptoJS.SHA512(b).toString(CryptoJS.enc.Hex)},dataType:"json",success:function(a){a.correct?window.location.href="dashboard.shtml":(c.text("Incorrect username or password."),g.focus())}})}function b(a){$.ajax({url:"../wsgi-scripts/resetemail.py",
method:"GET",data:{username:a},success:function(){$("#prompt").text("We have sent the password reset information to the email you registered with, please check your email.");e.removeClass("loading");f.removeAttr("disabled");f.text("Resend")},error:function(){e.removeClass("loading");d.css("background-color","yellow")}})}var c=$("#login_tip"),g=$("#username"),h=$("#password"),m=$("#button"),k=$("#dialog"),l=$("#cover"),d=$("#dialog_input"),f=$("#dialog_submit"),e=$("body");m.click(function(){a(g.val(),
h.val())});h.keyup(function(b){b&&13===b.keyCode&&a(g.val(),h.val())});$("#forgot").click(function(){k.show();l.show();d.focus()});l.click(function(){$(this).hide();k.hide()});f.click(function(){""!==d.val()?($(this).attr("disabled",""),e.addClass("loading"),b(d.val())):d.css("background-color","yellow")});d.keydown(function(){f.removeAttr("disabled");d.css("background-color","")});d.keyup(function(a){a&&13===a.keyCode&&f.click()})});
